<div class="container">
  <div class="d-flex flex-column align-items-start">
    <h2>Lista dei desideri</h2>

    <div *ngIf="messaggio" class="alert alert-success mt-2">
      {{ messaggio }}
    </div>

    <!-- Avvisi -->
    <div *ngIf="azioneMsg" class="alert alert-success mt-2">
      {{ azioneMsg }}
    </div>
    <div *ngIf="noPermessiMsg" class="alert alert-warning mt-2">
      {{ noPermessiMsg }}
    </div>

    <!-- Stato filtro -->
    <div class="mt-2 small text-muted">
      Risultati: {{ listaDesideriFiltrata.length }}
    </div>

    <!-- Nessun risultato -->
    <div *ngIf="listaDesideriFiltrata.length === 0 && (listaDesideri?.length || 0) > 0"
      class="alert alert-warning mt-2">
      Nessun film trovato in wishlist con il filtro corrente.
    </div>

    <!-- Griglia responsive -->
    <div class="row mt-3">
      <div class="col-6 col-md-4 col-lg-3 d-flex mb-3" *ngFor="let f of listaDesideriFiltrata">
        <div class="card h-100 shadow-sm">
          <!-- Poster -->
          <img *ngIf="f.posterPath" [src]="'https://image.tmdb.org/t/p/w300' + f.posterPath" class="card-img-top"
            alt="{{ f.titolo }}" />

          <!-- Corpo -->
          <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-2">{{ f.titolo }} ({{ f.anno }})</h5>
            <p class="mb-1"><strong>Formato:</strong> {{ f.formato }}</p>
            <p class="mb-3"><strong>Custodia:</strong> {{ f.custodia }}</p>

            <!-- Bottoni: dimensione standard, pieni, ben distanziati -->
            <div class="d-grid gap-2 mt-auto">
              <button type="button" class="btn btn-success" (click)="onClickAggiungiAllaCollezione(f)">
                Aggiungi alla collezione
              </button>
              <button type="button" class="btn btn-danger text-nowrap" (click)="onClickElimina(f)">
                Elimina
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #emptyWishlist>
      <div class="alert alert-info mt-3" *ngIf="(listaDesideri?.length || 0) === 0">
        La lista desideri è vuota.
      </div>
    </ng-template>

    <!-- Modale: ACCESSO RICHIESTO (gate) -->
    <div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-labelledby="loginRequiredLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="loginRequiredLabel" class="modal-title">Accesso richiesto</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
          </div>
          <div class="modal-body">
            Per eseguire questa operazione devi effettuare l’accesso.
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Annulla</button>
            <button class="btn btn-primary" (click)="procediAlLogin()">Accedi</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modale: CONFERMA RIMOZIONE -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 id="confirmDeleteLabel" class="modal-title">Conferma rimozione</h5>
            <button type="button" class="btn-close" aria-label="Chiudi" (click)="annullaDelete()"></button>
          </div>
          <div class="modal-body">
            Vuoi rimuovere
            <strong>{{ selectedForDelete?.titolo }}</strong>
            dalla lista desideri?
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" (click)="annullaDelete()">Annulla</button>
            <button class="btn btn-danger" [disabled]="isDeleting" (click)="confermaDelete()">
              {{ isDeleting ? 'Rimozione…' : 'Rimuovi' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Login Modal -->
    <app-login-modal #loginRef (loggedIn)="onLoggedIn($event)"></app-login-modal>
    <app-logout-modal #logoutRef [modalId]="'logoutModalWishlist'" (confermato)="confermaLogout()"></app-logout-modal>
  </div>