<nav id="siteNavbar" class="navbar navbar-expand-lg bg-nav-custom navbar-dark sticky-top px-3"
  [class.hidden]="isHidden">
  <div class="container-fluid">
    <a class="navbar-brand" style="line-height: 15px;" routerLink="/collezione">MyMovies <br> Collection</a>

    <button #navbarToggler class="navbar-toggler" type="button" (click)="onTogglerClick($event)"
      [attr.aria-expanded]="menuOpen" aria-controls="navbarContent" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div #navbarCollapse id="navbarContent" class="collapse navbar-collapse">
      <!-- Navigazione tra pagine -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" routerLink="/inserimento" routerLinkActive="active"
            (click)="onNavLinkClick('/inserimento')">Inserimento</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/collezione" routerLinkActive="active"
            (click)="onNavLinkClick('/collezione')">Collezione</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/lista-desideri" routerLinkActive="active"
            (click)="onNavLinkClick('/lista-desideri')">Lista desideri</a>
        </li>
      </ul>

      <!-- Gruppo destra: ricerca + utente -->
      <div class="d-md-flex ms-auto align-items-center gap-4 mt-2 mt-lg-0">
        <!-- Inserimento Manuale -->
        <button *ngIf="isInserimentoPage()" type="button" class="btn btn-outline-primary" (click)="apriInserimentoManuale()">
          Inserimento Manuale
        </button>

        <!-- Ricerca -->
        <form (ngSubmit)="onSubmit()" class="d-flex align-items-center gap-2 mb-0" role="search">
          <input class="form-control" type="search" placeholder="Cerca film" aria-label="Cerca" [(ngModel)]="query"
            name="query" (keydown.enter)="onSubmit(); $event.preventDefault();" />

          <!-- Bottone Pulisci: appare solo se c'Ã¨ testo -->
          <button *ngIf="query" type="button" class="btn btn-outline-secondary" (click)="clearSearch()"
            aria-label="Pulisci ricerca">
            Pulisci
          </button>

          <button class="btn btn-outline-success" type="submit">Cerca</button>
        </form>

        <!-- Utente -->
        <div class="d-flex align-items-center align-content-center gap-2 me-auto bottoneLoginOut">
          <ng-container *ngIf="!loggedIn; else loggedBlock">
            <button class="btn btn-outline-primary" (click)="apriLogin()">
              Login
            </button>
          </ng-container>
          <ng-template #loggedBlock>
            <span class="text-secondary text-light mr-0">Ciao</span>
            <span class="text-secondary text-light ml-0" *ngIf="username">{{ username }}</span>
            <button class="btn btn-outline-secondary" (click)="apriLogout()">
              Logout
            </button>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Modali gestiti dalla navbar -->
<app-login-modal #loginRef (loggedIn)="onLoggedIn($event)"></app-login-modal>
<app-logout-modal #logoutRef [modalId]="'logoutModalNavbar'" (confermato)="confermaLogout()"></app-logout-modal>